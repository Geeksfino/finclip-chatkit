name: AI-Bank
options:
  bundleIdPrefix: com.finclip.chatkit
  deploymentTarget:
    iOS: "16.0"

schemes:
  AI-Bank:
    build:
      targets:
        AI-Bank: all
    run:
      config: Debug

packages:
  ChatKit:
    url: https://github.com/Geeksfino/finclip-chatkit.git
    from: 0.1.0

targets:
  AI-Bank:
    type: application
    platform: iOS
    sources:
      - path: App/App
      - path: App/Coordinators
      - path: App/Models
      - path: App/Network
      - path: App/ViewControllers
    resources:
      - App/Resources/Assets.xcassets
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.finclip.chatkit.aibank
      PRODUCT_NAME: AI-Bank
      INFOPLIST_KEY_CFBundleDisplayName: AI-Bank
      INFOPLIST_FILE: App/App/Info.plist
      ENABLE_BITCODE: NO
      FRAMEWORK_SEARCH_PATHS: $(inherited) $(BUILT_PRODUCTS_DIR)/FinClipChatKit.framework/Frameworks
      LD_RUNPATH_SEARCH_PATHS: $(inherited) @executable_path/Frameworks @loader_path/Frameworks @loader_path/Frameworks/FinClipChatKit.framework/Frameworks
      SWIFT_INCLUDE_PATHS: $(inherited) $(BUILT_PRODUCTS_DIR)/FinClipChatKit.framework/Frameworks
    postbuildScripts:
      - name: Sign Nested ChatKit Frameworks
        shell: /bin/sh
        script: |
          FRAMEWORK_DIR="${TARGET_BUILD_DIR}/${FRAMEWORKS_FOLDER_PATH}/FinClipChatKit.framework/Frameworks"
          if [ -d "${FRAMEWORK_DIR}" ]; then
            find "${FRAMEWORK_DIR}" -type d -name "*.framework" -print0 | while IFS= read -r -d '' FRAME; do
              /usr/bin/codesign --force --sign "${EXPANDED_CODE_SIGN_IDENTITY}" --preserve-metadata=identifier,entitlements "${FRAME}" || exit 1
            done
          fi
    dependencies:
      - package: ChatKit
